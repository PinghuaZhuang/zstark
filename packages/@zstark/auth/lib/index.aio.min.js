!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.nestarkAuth={})}(this,function(e){"use strict";function t(e){"@babel/helpers - typeof";return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}function r(){}function o(){o.init.call(this)}function i(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function a(e,t,n){if(t)e.call(n);else for(var r=e.length,o=g(e,r),i=0;i<r;++i)o[i].call(n)}function s(e,t,n,r){if(t)e.call(n,r);else for(var o=e.length,i=g(e,o),a=0;a<o;++a)i[a].call(n,r)}function u(e,t,n,r,o){if(t)e.call(n,r,o);else for(var i=e.length,a=g(e,i),s=0;s<i;++s)a[s].call(n,r,o)}function c(e,t,n,r,o,i){if(t)e.call(n,r,o,i);else for(var a=e.length,s=g(e,a),u=0;u<a;++u)s[u].call(n,r,o,i)}function f(e,t,n,r){if(t)e.apply(n,r);else for(var o=e.length,i=g(e,o),a=0;a<o;++a)i[a].apply(n,r)}function l(e,t,n,o){var a,s,u;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(s=e._events,s?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),u=s[t]):(s=e._events=new r,e._eventsCount=0),u){if("function"==typeof u?u=s[t]=o?[n,u]:[u,n]:o?u.unshift(n):u.push(n),!u.warned&&(a=i(e))&&a>0&&u.length>a){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=u.length,p(c)}}else u=s[t]=n,++e._eventsCount;return e}function p(e){"function"==typeof console.warn?console.warn(e):console.log(e)}function d(e,t,n){function r(){e.removeListener(t,r),o||(o=!0,n.apply(e,arguments))}var o=!1;return r.listener=n,r}function h(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function v(e,t){for(var n=t,r=n+1,o=e.length;r<o;n+=1,r+=1)e[n]=e[r];e.pop()}function g(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function y(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function m(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var o=1,i="",a=n+1;if("?"===e[a])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<e.length;)if("\\"!==e[a]){if(")"===e[a]){if(0===--o){a++;break}}else if("("===e[a]&&(o++,"?"!==e[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);i+=e[a++]}else i+=e[a++]+e[a++];if(o)throw new TypeError("Unbalanced pattern at "+n);if(!i)throw new TypeError("Missing pattern at "+n);t.push({type:"PATTERN",index:n,value:i}),n=a}else{for(var s="",a=n+1;a<e.length;){var u=e.charCodeAt(a);{if(!(u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||95===u))break;s+=e[a++]}}if(!s)throw new TypeError("Missing parameter name at "+n);t.push({type:"NAME",index:n,value:s}),n=a}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}function w(e,t){void 0===t&&(t={});for(var n=m(e),r=t.prefixes,o=void 0===r?"./":r,i="[^"+E(t.delimiter||"/#?")+"]+?",a=[],s=0,u=0,c="",f=function(e){if(u<n.length&&n[u].type===e)return n[u++].value},l=function(e){var t=f(e);if(void 0!==t)return t;var r=n[u],o=r.type,i=r.index;throw new TypeError("Unexpected "+o+" at "+i+", expected "+e)},p=function(){for(var e,t="";e=f("CHAR")||f("ESCAPED_CHAR");)t+=e;return t};u<n.length;){var d=f("CHAR"),h=f("NAME"),v=f("PATTERN");if(h||v){var g=d||"";-1===o.indexOf(g)&&(c+=g,g=""),c&&(a.push(c),c=""),a.push({name:h||s++,prefix:g,suffix:"",pattern:v||i,modifier:f("MODIFIER")||""})}else{var y=d||f("ESCAPED_CHAR");if(y)c+=y;else{c&&(a.push(c),c="");if(f("OPEN")){var g=p(),w=f("NAME")||"",b=f("PATTERN")||"",j=p();l("CLOSE"),a.push({name:w||(b?s++:""),pattern:w&&!b?i:b,prefix:g,suffix:j,modifier:f("MODIFIER")||""})}else l("END")}}}return a}function b(e,t){return j(w(e,t),t)}function j(e,n){void 0===n&&(n={});var r=A(n),o=n.encode,i=void 0===o?function(e){return e}:o,a=n.validate,s=void 0===a||a,u=e.map(function(e){if("object"===t(e))return new RegExp("^(?:"+e.pattern+")$",r)});return function(t){for(var n="",r=0;r<e.length;r++){var o=e[r];if("string"!=typeof o){var a=t?t[o.name]:void 0,c="?"===o.modifier||"*"===o.modifier,f="*"===o.modifier||"+"===o.modifier;if(Array.isArray(a)){if(!f)throw new TypeError('Expected "'+o.name+'" to not repeat, but got an array');if(0===a.length){if(c)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var l=0;l<a.length;l++){var p=i(a[l],o);if(s&&!u[r].test(p))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but got "'+p+'"');n+=o.prefix+p+o.suffix}}else if("string"!=typeof a&&"number"!=typeof a){if(!c){var d=f?"an array":"a string";throw new TypeError('Expected "'+o.name+'" to be '+d)}}else{var p=i(String(a),o);if(s&&!u[r].test(p))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but got "'+p+'"');n+=o.prefix+p+o.suffix}}else n+=o}return n}}function x(e,t){var n=[];return O(k(e,n,t),n,t)}function O(e,t,n){void 0===n&&(n={});var r=n.decode,o=void 0===r?function(e){return e}:r;return function(n){var r=e.exec(n);if(!r)return!1;for(var i=r[0],a=r.index,s=Object.create(null),u=1;u<r.length;u++)!function(e){if(void 0===r[e])return"continue";var n=t[e-1];"*"===n.modifier||"+"===n.modifier?s[n.name]=r[e].split(n.prefix+n.suffix).map(function(e){return o(e,n)}):s[n.name]=o(r[e],n)}(u);return{path:i,index:a,params:s}}}function E(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function A(e){return e&&e.sensitive?"":"i"}function C(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,o=n.exec(e.source);o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}function L(e,t,n){var r=e.map(function(e){return k(e,t,n).source});return new RegExp("(?:"+r.join("|")+")",A(n))}function P(e,t,n){return _(w(e,n),t,n)}function _(e,t,n){void 0===n&&(n={});for(var r=n.strict,o=void 0!==r&&r,i=n.start,a=void 0===i||i,s=n.end,u=void 0===s||s,c=n.encode,f=void 0===c?function(e){return e}:c,l="["+E(n.endsWith||"")+"]|$",p="["+E(n.delimiter||"/#?")+"]",d=a?"^":"",h=0,v=e;h<v.length;h++){var g=v[h];if("string"==typeof g)d+=E(f(g));else{var y=E(f(g.prefix)),m=E(f(g.suffix));if(g.pattern)if(t&&t.push(g),y||m)if("+"===g.modifier||"*"===g.modifier){var w="*"===g.modifier?"?":"";d+="(?:"+y+"((?:"+g.pattern+")(?:"+m+y+"(?:"+g.pattern+"))*)"+m+")"+w}else d+="(?:"+y+"("+g.pattern+")"+m+")"+g.modifier;else d+="("+g.pattern+")"+g.modifier;else d+="(?:"+y+m+")"+g.modifier}}if(u)o||(d+=p+"?"),d+=n.endsWith?"(?="+l+")":"$";else{var b=e[e.length-1],j="string"==typeof b?p.indexOf(b[b.length-1])>-1:void 0===b;o||(d+="(?:"+p+"(?="+l+"))?"),j||(d+="(?="+p+"|"+l+")")}return new RegExp(d,A(n))}function k(e,t,n){return e instanceof RegExp?C(e,t):Array.isArray(e)?L(e,t,n):P(e,t,n)}function R(e){for(var t=e.length;t--&&je.test(e.charAt(t)););return t}function I(e){return e?e.slice(0,xe(e)+1).replace(Oe,""):e}function S(e){var n=t(e);return null!=e&&("object"==n||"function"==n)}function T(e){var t=Te.call(e,De),n=e[De];try{e[De]=void 0;var r=!0}catch(e){}var o=Ne.call(e);return r&&(t?e[De]=n:delete e[De]),o}function N(e){return He.call(e)}function D(e){return null==e?void 0===e?$e:Be:ze&&ze in Object(e)?Ue(e):Me(e)}function U(e){return null!=e&&"object"==t(e)}function F(e){return"symbol"==t(e)||We(e)&&Ve(e)==qe}function H(e){if("number"==typeof e)return e;if(Ke(e))return Qe;if(Ae(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Ae(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ee(e);var n=Ze.test(e);return n||Ge.test(e)?Xe(e.slice(2),n?2:8):Je.test(e)?Qe:+e}function M(e){if(!e)return 0===e?e:0;if((e=Ye(e))===et||e===-et){return(e<0?-1:1)*tt}return e===e?e:0}function B(e){var t=nt(e),n=t%1;return t===t?n?t-n:t:0}function $(e,t){var n;if("function"!=typeof t)throw new TypeError(ot);return e=rt(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}function z(e){return it(2,e)}var V="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};r.prototype=Object.create(null),o.EventEmitter=o,o.usingDomains=!1,o.prototype.domain=void 0,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.init=function(){this.domain=null,o.usingDomains&&(!(void 0).active||this instanceof(void 0).Domain||(this.domain=(void 0).active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new r,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return i(this)},o.prototype.emit=function(e){var t,n,r,o,i,l,p,d="error"===e;if(l=this._events)d=d&&null==l.error;else if(!d)return!1;if(p=this.domain,d){if(t=arguments[1],!p){if(t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=p,t.domainThrown=!1,p.emit("error",t),!1}if(!(n=l[e]))return!1;var v="function"==typeof n;switch(r=arguments.length){case 1:a(n,v,this);break;case 2:s(n,v,this,arguments[1]);break;case 3:u(n,v,this,arguments[1],arguments[2]);break;case 4:c(n,v,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(r-1),i=1;i<r;i++)o[i-1]=arguments[i];f(n,v,this,o)}return!0},o.prototype.addListener=function(e,t){return l(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return l(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,o,i,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(n=o[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new r:(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){s=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new r,this;delete o[e]}else v(n,i);o.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new r,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new r:delete n[e]),this;if(0===arguments.length){for(var o,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(o=i[a])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new r,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},o.prototype.listeners=function(e){var t,n,r=this._events;return r?(t=r[e],n=t?"function"==typeof t?[t.listener||t]:y(t):[]):n=[],n},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var W=Object.freeze({default:o,EventEmitter:o}),q=n(function(e,t){!function(t){if(e.exports=t(),!!0){var n=window.Cookies,r=window.Cookies=t();r.noConflict=function(){return window.Cookies=n,r}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function n(r){function o(){}function i(t,n,i){if("undefined"!=typeof document){i=e({path:"/"},o.defaults,i),"number"==typeof i.expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var u in i)i[u]&&(s+="; "+u,!0!==i[u]&&(s+="="+i[u].split(";")[0]));return document.cookie=t+"="+n+s}}function a(e,n){if("undefined"!=typeof document){for(var o={},i=document.cookie?document.cookie.split("; "):[],a=0;a<i.length;a++){var s=i[a].split("="),u=s.slice(1).join("=");n||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var c=t(s[0]);if(u=(r.read||r)(u,c)||t(u),n)try{u=JSON.parse(u)}catch(e){}if(o[c]=u,e===c)break}catch(e){}}return e?o[e]:o}}return o.set=i,o.get=function(e){return a(e,!1)},o.getJSON=function(e){return a(e,!0)},o.remove=function(t,n){i(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}return n(function(){})})}),K=Object.prototype.hasOwnProperty,Q=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),J=function(e){for(var t;e.length;){var n=e.pop();if(t=n.obj[n.prop],Array.isArray(t)){for(var r=[],o=0;o<t.length;++o)void 0!==t[o]&&r.push(t[o]);n.obj[n.prop]=r}}return t},Z=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n},G=function e(n,r,o){if(!r)return n;if("object"!==t(r)){if(Array.isArray(n))n.push(r);else{if("object"!==t(n))return[n,r];(o.plainObjects||o.allowPrototypes||!K.call(Object.prototype,r))&&(n[r]=!0)}return n}if("object"!==t(n))return[n].concat(r);var i=n;return Array.isArray(n)&&!Array.isArray(r)&&(i=Z(n,o)),Array.isArray(n)&&Array.isArray(r)?(r.forEach(function(r,i){K.call(n,i)?n[i]&&"object"===t(n[i])?n[i]=e(n[i],r,o):n.push(r):n[i]=r}),n):Object.keys(r).reduce(function(t,n){var i=r[n];return K.call(t,n)?t[n]=e(t[n],i,o):t[n]=i,t},i)},X=function(e,t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},Y=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},ee=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),n="",r=0;r<t.length;++r){var o=t.charCodeAt(r);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?n+=t.charAt(r):o<128?n+=Q[o]:o<2048?n+=Q[192|o>>6]+Q[128|63&o]:o<55296||o>=57344?n+=Q[224|o>>12]+Q[128|o>>6&63]+Q[128|63&o]:(r+=1,o=65536+((1023&o)<<10|1023&t.charCodeAt(r)),n+=Q[240|o>>18]+Q[128|o>>12&63]+Q[128|o>>6&63]+Q[128|63&o])}return n},te=function(e){for(var n=[{obj:{o:e},prop:"o"}],r=[],o=0;o<n.length;++o)for(var i=n[o],a=i.obj[i.prop],s=Object.keys(a),u=0;u<s.length;++u){var c=s[u],f=a[c];"object"===t(f)&&null!==f&&-1===r.indexOf(f)&&(n.push({obj:a,prop:c}),r.push(f))}return J(n)},ne=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},re=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},oe={arrayToObject:Z,assign:X,compact:te,decode:Y,encode:ee,isBuffer:re,isRegExp:ne,merge:G},ie=String.prototype.replace,ae=/%20/g,se={default:"RFC3986",formatters:{RFC1738:function(e){return ie.call(e,ae,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},ue={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},ce=Date.prototype.toISOString,fe={delimiter:"&",encode:!0,encoder:oe.encode,encodeValuesOnly:!1,serializeDate:function(e){return ce.call(e)},skipNulls:!1,strictNullHandling:!1},le=function e(t,n,r,o,i,a,s,u,c,f,l,p){var d=t;if("function"==typeof s)d=s(n,d);else if(d instanceof Date)d=f(d);else if(null===d){if(o)return a&&!p?a(n,fe.encoder):n;d=""}if("string"==typeof d||"number"==typeof d||"boolean"==typeof d||oe.isBuffer(d)){if(a){return[l(p?n:a(n,fe.encoder))+"="+l(a(d,fe.encoder))]}return[l(n)+"="+l(String(d))]}var h=[];if(void 0===d)return h;var v;if(Array.isArray(s))v=s;else{var g=Object.keys(d);v=u?g.sort(u):g}for(var y=0;y<v.length;++y){var m=v[y];i&&null===d[m]||(h=Array.isArray(d)?h.concat(e(d[m],r(n,m),r,o,i,a,s,u,c,f,l,p)):h.concat(e(d[m],n+(c?"."+m:"["+m+"]"),r,o,i,a,s,u,c,f,l,p)))}return h},pe=function(e,n){var r=e,o=n?oe.assign({},n):{};if(null!==o.encoder&&void 0!==o.encoder&&"function"!=typeof o.encoder)throw new TypeError("Encoder has to be a function.");var i=void 0===o.delimiter?fe.delimiter:o.delimiter,a="boolean"==typeof o.strictNullHandling?o.strictNullHandling:fe.strictNullHandling,s="boolean"==typeof o.skipNulls?o.skipNulls:fe.skipNulls,u="boolean"==typeof o.encode?o.encode:fe.encode,c="function"==typeof o.encoder?o.encoder:fe.encoder,f="function"==typeof o.sort?o.sort:null,l=void 0!==o.allowDots&&o.allowDots,p="function"==typeof o.serializeDate?o.serializeDate:fe.serializeDate,d="boolean"==typeof o.encodeValuesOnly?o.encodeValuesOnly:fe.encodeValuesOnly;if(void 0===o.format)o.format=se.default;else if(!Object.prototype.hasOwnProperty.call(se.formatters,o.format))throw new TypeError("Unknown format option provided.");var h,v,g=se.formatters[o.format];"function"==typeof o.filter?(v=o.filter,r=v("",r)):Array.isArray(o.filter)&&(v=o.filter,h=v);var y=[];if("object"!==t(r)||null===r)return"";var m;m=o.arrayFormat in ue?o.arrayFormat:"indices"in o?o.indices?"indices":"repeat":"indices";var w=ue[m];h||(h=Object.keys(r)),f&&h.sort(f);for(var b=0;b<h.length;++b){var j=h[b];s&&null===r[j]||(y=y.concat(le(r[j],j,w,a,s,u?c:null,v,f,l,p,g,d)))}var x=y.join(i),O=!0===o.addQueryPrefix?"?":"";return x.length>0?O+x:""},de=Object.prototype.hasOwnProperty,he={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:oe.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},ve=function(e,t){for(var n={},r=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=t.parameterLimit===1/0?void 0:t.parameterLimit,i=r.split(t.delimiter,o),a=0;a<i.length;++a){var s,u,c=i[a],f=c.indexOf("]="),l=-1===f?c.indexOf("="):f+1;-1===l?(s=t.decoder(c,he.decoder),u=t.strictNullHandling?null:""):(s=t.decoder(c.slice(0,l),he.decoder),u=t.decoder(c.slice(l+1),he.decoder)),de.call(n,s)?n[s]=[].concat(n[s]).concat(u):n[s]=u}return n},ge=function(e,t,n){for(var r=t,o=e.length-1;o>=0;--o){var i,a=e[o];if("[]"===a)i=[],i=i.concat(r);else{i=n.plainObjects?Object.create(null):{};var s="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=parseInt(s,10);!isNaN(u)&&a!==s&&String(u)===s&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(i=[],i[u]=r):i[s]=r}r=i}return r},ye=function(e,t,n){if(e){var r=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,i=/(\[[^[\]]*])/g,a=o.exec(r),s=a?r.slice(0,a.index):r,u=[];if(s){if(!n.plainObjects&&de.call(Object.prototype,s)&&!n.allowPrototypes)return;u.push(s)}for(var c=0;null!==(a=i.exec(r))&&c<n.depth;){if(c+=1,!n.plainObjects&&de.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+r.slice(a.index)+"]"),ge(u,t,n)}},me=function(e,t){var n=t?oe.assign({},t):{};if(null!==n.decoder&&void 0!==n.decoder&&"function"!=typeof n.decoder)throw new TypeError("Decoder has to be a function.");if(n.ignoreQueryPrefix=!0===n.ignoreQueryPrefix,n.delimiter="string"==typeof n.delimiter||oe.isRegExp(n.delimiter)?n.delimiter:he.delimiter,n.depth="number"==typeof n.depth?n.depth:he.depth,n.arrayLimit="number"==typeof n.arrayLimit?n.arrayLimit:he.arrayLimit,n.parseArrays=!1!==n.parseArrays,n.decoder="function"==typeof n.decoder?n.decoder:he.decoder,n.allowDots="boolean"==typeof n.allowDots?n.allowDots:he.allowDots,n.plainObjects="boolean"==typeof n.plainObjects?n.plainObjects:he.plainObjects,n.allowPrototypes="boolean"==typeof n.allowPrototypes?n.allowPrototypes:he.allowPrototypes,n.parameterLimit="number"==typeof n.parameterLimit?n.parameterLimit:he.parameterLimit,n.strictNullHandling="boolean"==typeof n.strictNullHandling?n.strictNullHandling:he.strictNullHandling,""===e||null===e||void 0===e)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof e?ve(e,n):e,o=n.plainObjects?Object.create(null):{},i=Object.keys(r),a=0;a<i.length;++a){var s=i[a],u=ye(s,r[s],n);o=oe.merge(o,u,n)}return oe.compact(o)},we={formats:se,parse:me,stringify:pe},be=Object.freeze({parse:w,compile:b,tokensToFunction:j,match:x,regexpToFunction:O,tokensToRegexp:_,pathToRegexp:k}),je=/\s/,xe=R,Oe=/^\s+/,Ee=I,Ae=S,Ce="object"==t(V)&&V&&V.Object===Object&&V,Le=Ce,Pe="object"==("undefined"==typeof self?"undefined":t(self))&&self&&self.Object===Object&&self,_e=Le||Pe||Function("return this")(),ke=_e,Re=ke.Symbol,Ie=Re,Se=Object.prototype,Te=Se.hasOwnProperty,Ne=Se.toString,De=Ie?Ie.toStringTag:void 0,Ue=T,Fe=Object.prototype,He=Fe.toString,Me=N,Be="[object Null]",$e="[object Undefined]",ze=Ie?Ie.toStringTag:void 0,Ve=D,We=U,qe="[object Symbol]",Ke=F,Qe=NaN,Je=/^[-+]0x[0-9a-f]+$/i,Ze=/^0b[01]+$/i,Ge=/^0o[0-7]+$/i,Xe=parseInt,Ye=H,et=1/0,tt=1.7976931348623157e308,nt=M,rt=B,ot="Expected a function",it=$,at=z,st=W&&o||W,ut=n(function(e,n){function r(e){return e&&"object"===t(e)&&"default"in e?e.default:e}function o(e){var t=decodeURIComponent(e.split("?")[1]).replace(/\+/g," ");if(!t)return{};var n={};return t.split("&").forEach(function(e){var t=e.indexOf("=");if(-1!==t){var r=e.substring(0,t),o=e.substring(t+1,e.length);n[r]=decodeURIComponent(o)}}),n}function i(e){return"production"!==e&&e.length?e+".":""}function a(e,t){R.on(e,t)}function s(e){return{type:I,data:e}}function u(e){return{type:S,data:e}}function c(e){R.emit(e.type,e)}function f(e){var t=e.after,n=e.before;a(I,function(e){return n&&n(e)}),a(S,function(e){return t&&t(e)})}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;return t!==U&&t.length?e+"-".concat(t):e}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0,n=A.get(l(N,e));return!n&&t&&(n=t[N.replace(/-/g,"_")])?(d(n,e),n):n}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;A.set(l(N,t),e,{expires:F})}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0,n=A.get(l(T,e));return!n&&t&&(n=t[T.replace(/-/g,"_")])?(v(n,e),n):n}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;A.set(l(T,t),e,{expires:F})}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0,n=A.get(l(D,e));return!n&&t&&(n=t[D.replace(/-/g,"_")])?(y(n,e),n):n}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;A.set(l(D,t),e,{expires:F})}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U;A.remove(l(D,e)),A.remove(l(T,e)),A.remove(l(N,e)),/98du.com$/.test(window.location.hostname)&&(A.remove(l(D,e),{domain:".98du.com"}),A.remove(l(T,e),{domain:".98du.com"}),A.remove(l(N,e),{domain:".98du.com"}))}function w(e,t,n,r){var o=new Error(r);return o._isAuth=!0,o.from=e,o.to=t,o.type=n,o}function b(e){var t=new FormData,n=p(e);return null==n?(console.warn(">>> 退出登录需要使用token. token获取失败. token: ".concat(n)),Promise.resolve({message:"退出登录需要使用token. token获取失败",token:n})):(t.set("token",p(e).replace("Bearer ","")),M("http://".concat(i(e),"nadmin-java.uheixia.com/api/auth/ehr_logout"),{method:"post",body:t}).then(function(e){return e.json()}))}function j(e,t){return M("http://".concat(i(e),"ehr-java.98du.com/api/user/getInfoById?").concat(we.stringify(t)),{method:"get",headers:{Authorization:"Bearer ".concat(p(e))}}).then(function(e){return e.json()})}function x(e,t){return M("http://".concat(i(e),"ehr-java.98du.com/api/project/getProjectByUserId?").concat(we.stringify(t)),{method:"get",headers:{Authorization:"Bearer ".concat(p(e))}}).then(function(e){return e.json()})}function O(){if(!B.started){if(!p(B.env))throw w("","","start","<<< 无法获取Authorization, 请先执行start(). ");console.warn("<<< 请先执行start().")}}Object.defineProperty(n,"__esModule",{value:!0});var E=r(st),A=r(q),C=r(at),L="undefined"!=typeof window,P=L&&function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"function"==typeof window.history.pushState)}(),_=window,k=_.history,R=new E.EventEmitter,I="nehook:auth-befroe",S="nehook:auth-after",T="nauth-userid",N="nauth-token",D="nauth-username",U="production",F=15,H=window,M=H.fetch,B={started:!1,path:"/login",start:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!P)throw w("","","before","<<< not support history.pushState.");var n=t.path,r=t.env,o=t.after,i=t.before;this.options=t,this.started=!0,this.path=n||this.path,this.regex=be.pathToRegexp(this.path),this.matcher=be.match(this.path),this.env=r||(/^(127.0.0.1)|(localhost)|(localdev)|(192.168)/.test(window.location.hostname)?"localdev":"production"),this.options.env=this.env,this.projectId=this.getProjectIdWitchCache(),this.registerHook({after:function(t){return o?o(t):e.isAuthLogin(t.data.from.path)?window.location.href=window.location.origin:void(window.location.href=window.location.origin+t.data.from.fullPath)},before:i}),this.setupListeners()},isAuthLogin:function(e){return!!this.regex&&!!this.regex.exec(e)},registerHook:f,setupListeners:function(){var e=this,t=k.pushState,n=this;k.pushState=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(n.isAuthLogin.call(n,a.split("?")[0])){var f=window.location,l=f.pathname,d=f.search,v=n.matcher.bind(n),y=a.split("?"),m=v(l),w=v(y[0]),b={fullPath:l+d,path:l,query:o(l),params:m?m.params:{},regex:n.regex},j={fullPath:a,path:y[0],query:o(a),params:Object.assign(w?w.params:{},r),regex:n.regex};c(s({from:b,to:j})),n.updateRoute.call(n,j);var x=p(e.env,j.query);if(!x)return n.loginOut.call(n,j.params);t.call(k,r,i,a),c(u({userid:h(e.env,j.query),token:x,username:g(e.env,j.query),to:j,from:b}))}return t.call(k,r,i,a)},this.isAuthLogin(window.location.pathname)&&k.pushState({},"",window.location.pathname+window.location.search)},updateRoute:function(e){this.route?Object.assign(this.route,e):this.route=Object.assign({},e)},login:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(O(),!0===e||"string"==typeof e){var r=function(){return t.goAuthView("string"==typeof n?{}:n,"string"==typeof e?e:void 0)};return this.options&&this.options.onLogin?this.options.onLogin(r,Object.assign({},this.options,{token:p(this.env)})):r()}k.pushState(e,"",this.transformPath(e||{})+("string"==typeof n?"?"+n:""))},loginOut:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return O(),b(this.env).then(function(){var r=function(){m(e.env),"string"==typeof t?e.goAuthView({},t):e.goAuthView(t,"string"==typeof n?n:"")};return e.options&&e.options.onLoginOut?e.options.onLoginOut(r,Object.assign({},e.options,{token:p(e.env)})):r()})},goAuthView:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;window.location.href="http://".concat("production"!==this.env?this.env+".":"","auth.98du.com/login")+"?url=".concat(window.location.origin+this.transformPath(e)).concat(t?"&"+t:"")},transformPath:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return be.compile(this.path,{encode:encodeURIComponent})(e)},getProjectIdWitchCache:function(){if(window.ICESTARK&&window.ICESTARK.store.store.curProject){return window.ICESTARK.store.store.curProject.source.wnlProjectId}return null},getProjectId:function(e,t){var n=this;O();var r=this.getProjectIdWitchCache();if(r)return Promise.resolve(r);if("string"!=typeof e)return Promise.reject(new Error("<<< getProjectId 需要name参数."));var o=B.env,a=t?"\\?"+we.stringify(t):"";return x(o,{userId:h(o)}).then(function(t){var s=t.data,u=s.find(function(t){return new RegExp("^//".concat(i(o).replace(/\./g,"\\.")).concat(e,"\\.98du\\.com").concat(a)).test(t.domain)||t.domain===e});return u?r=n.projectId=u.wnlProjectId:null})}};B.start=C(B.start.bind(B));var $={version:"1.3.4",get token(){return O(),p(B.env)},get env(){return O(),B.env},get started(){return O(),B.started},get projectId(){return B.projectId},support:{get pushState(){return P}},getUserInfo:function(){O();var e=B.env;return{token:p(e),userid:h(e),username:g(e)}},getUserInfoAll:function(){return O(),j(B.env,{userId:this.getUserInfo().userid})},getProjectId:B.getProjectId.bind(B),login:B.login.bind(B),loginOut:B.loginOut.bind(B),start:B.start.bind(B)},z=$.start,V=$.login,W=$.loginOut;n.start=z,n.login=V,n.loginOut=W,n.default=$}),ct=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(ut),ft=ut.start,lt=ut.login,pt=ut.loginOut;e.default=ct,e.start=ft,e.login=lt,e.loginOut=pt,Object.defineProperty(e,"__esModule",{value:!0})});
